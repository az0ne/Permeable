metasploit渗透防御终极手册2012-09-08 15:10:50     我来说两句       收藏    我要投稿 昨晚上睡不着就无聊玩玩metasploit攻击,哎让我大失所所望，整来整去是一个垃圾东东，可能对win还用点没有那么多安全防御手段，可是对于linux.bsd简直就是废物一个。
  我使用的免费版本的metasploit,更新到了最新的漏洞配对攻击模块库，当然我也更新了最新的xp补丁，结果硬是没搞下来。。。悲哀。。。这个软件有一个pro收费版本，不知道多少钱反正哥不信了Pro版的区别是：
  1，有更多更新的攻击漏洞模块
 2，集成nexo扫描模块，免费的只有nmap
  3,更智能的攻击自动处理
  4，有更强大的IDS/IDP evasion逃逸免杀功能（吹吧。牛就是这样上天的）
  其运行的原理简单的来讲，就是：
  1，使用nmap nexo nss等扫描软件扫描当前目标的各种端口服务，漏洞等
  2，把结果db_import到postgre数据库中去（郁闷为什不使用mysql.memcached,redis或者直接把所有的模块直接放进mongodb中去呢）
  3，serach漏洞库进行端口 服务比对扫描攻击
 本人是菜鸟，没有能力自己发掘软件漏洞，定义攻击模块，就使用了动攻击模式：
   1，db_namp -A -T4 -Pn 目标ip (没有使用其他的扫描工具，没意义）
   2,db_autopwn -t -p -e  （免费版去除了，害我自己下载装的）
   3,session n      （可惜啊，连满补丁的xp都没成功溢出，拿不到会话，也没用上悲哀！0
 说白了，metasploit一般来说就是使用当前被公布的或者自己定义的（高手）漏洞模块加入到漏洞仓库中去进行杀毒软件一样的反向被动扫描。。很弱智。豪无主动性。。。如果你看过本人之前写过的那篇“分层纵深防御，一切黑客入侵都是浮云”http://www.2cto.com/Article/201208/146787.html 基本上就不需要考虑这种攻击了。。
 
   但是看到很多兄弟深谙此道，动不动就搞我最爱的xp系统（估计连个补丁都不给打上），连个防火墙也不装，直接搞咱们的杀毒软件，有意思吗！我估计换一个win8都会让牛头疼，为了让广大的和我一样的菜鸟兄弟们看清metaspoliot真面目，避免把自己有限的生命浪费在这种无用的溢出软件上（我们还有很多重要的事情要去做呢），我这里就专门给出一些彻底防御metasploit渗透攻击的的建议，仅供参考，请勿用于生产环境，出了事与本人无关^_^：
 
  1 ，所有下载的系统和服务器软件必须到官方网站下载同时进行md5 sha512验证
  2，安装完基本的linux系统，马上进行系统的安全升级，特别是那些重要的通用共享库，一般这个是自动的。
  3，定制精简内核，去除所有无用的驱动，功能，调试模式（除非你是内核调试专家），打上Grsecurity,tomoyo等补丁关于内核版本选择我的建议是以rhel debian的发行版为基准考虑，没有什么必要不要选用通用的主线kernel,漏洞很多。如果为了新功能也要选择大版本号与当前的使用的debian/rhel发行版一样，小版本号必须是最高的内核，这样kapi兼容更好。
  4，最高安全防止所有安全崩溃，请所有的linux内核服务器软件都有两套系统，，比如内核一个是最新的linux3.5.3 一个是发行版稳定的2.6.32系列，这样可以给我们以切换维护时间。同时不耽误生产，服务器软件比如nginx apache都要部署，不管哪个除了问题另外一个可接接力！（现在什么都是双核的，四核心的）
  5，所有服务其软件nginx,mysql等等，必须加入gcc4.7.1 -fstack-protect-all选项加强溢出防御，同时如果没有必要请关闭所有的debug调试功能，毕竟程序设计谁也不能保证没有漏洞，除非你不是人！当然内核中也有这个选项，我们一般不开，原因是一般内核的溢出都是本地的多，而且内核被打上那个选项一溢出马上崩溃，本身也是一种不好的行为，还有就是太影响性能，再说内核有Grsecurity安全补丁保护，重复了。。所以不开！
  6，每个服务器软件必须修改源代码verion.h头文件，伪装软件，把nginx变成apache,或者版本号乱写，这样加大了扫描的难度，还有迷惑那些手动扫描的黑客的，影藏软件的所有无用信息，同时开启内核Grsecurity tcpu序列号随机功能，防止tcp序列号攻击扫描判断！（很强吧对付nmap)
  7，使用精简定制的freebsd-pf防火墙进行syn代理，同时关闭所有无用的端口，只开放80端口，让扫描风险大大降低，同时加入并发控制，一般扫描都要很多连接，超过了就封，
 
  8，在交换机复制端口，部署IDS系统-snort进行类似7层防火墙一样的应用层匹配扫描，发现扫描溢出攻击，反馈给防火墙进行封锁，淡然如果你们公司很有钱可以使用专业的IDS/IDP或者7层放火墙。
 
  9，设置nginx,apache的安全模块功能，防止cc攻击。。防止多连接扫描。
 
  10，如果真的遇到超级牛人硬是溢出了，可以参考之前写的”linux核心蜜罐系统，分析入侵，斩断黑手“http://www.2cto.com/Article/201209/153894.html可以部署mac(sellinux,tomoyo,appa)强制访问控制，沙盒化被溢出的程序，同时报警，让咱们切换程序版本。。让那些牛人直接发牛脾气呵呵！
   11，最后的防线，定时合理的备份时最原始，最简单，最有效地防御。。
 
   通过以上10点的调整，您的系统估计是刀枪不入了，当然了人为的放水出外哦，metaploist就是玩玩xp，不设安全防御的系统，不是什么神一样的东东，，要不百度，新浪睡的着啊呵呵
 
  写在最后，不要盲目相信某种攻击或者安全软件，安全和攻击永远都是矛盾发展的，我们要发挥所有安全工具防御所有的安全攻击，把思考的层次提高，2维度不行就3维度，循环嵌套，多样部署，层层防御，把现有的安全防御软件攻击软件，创新了用，才能有所收获，有所成就